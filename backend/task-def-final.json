{
    "family": "uslugar",
    "taskRoleArn": null,
    "executionRoleArn": "arn:aws:iam::666203386231:role/ecsTaskExecutionRole",
    "networkMode": "awsvpc",
    "containerDefinitions": [
        {
            "name": "uslugar",
            "image": "666203386231.dkr.ecr.eu-north-1.amazonaws.com/uslugar-backend:latest",
            "cpu": 0,
            "portMappings": [
                {
                    "containerPort": 8080,
                    "hostPort": 8080,
                    "protocol": "tcp",
                    "name": "uslugar-8080-tcp"
                }
            ],
            "essential": true,
            "environment": [
                {
                    "name": "PORT",
                    "value": "8080"
                },
                {
                    "name": "VAPID_PUBLIC_KEY",
                    "value": "BDG4-j--YWXbakF85YGca1YvaghsIlnsxDIT9RnK1Obiga15pMgNbl2i-HVcoDgrZvZyPMlJMQrabWGa1-7xr30"
                },
                {
                    "name": "VAPID_SUBJECT",
                    "value": "mailto:admin@uslugar.oriph.io"
                }
            ],
            "mountPoints": [],
            "volumesFrom": [],
            "secrets": [
                {
                    "name": "DATABASE_URL",
                    "valueFrom": "arn:aws:secretsmanager:eu-north-1:666203386231:secret:uslugar-db-secret-FBWhyv:DATABASE_URL::"
                },
                {
                    "name": "SMTP_HOST",
                    "valueFrom": "arn:aws:secretsmanager:eu-north-1:666203386231:secret:uslugar-smtp-config-5xXBg5:SMTP_HOST::"
                },
                {
                    "name": "SMTP_PORT",
                    "valueFrom": "arn:aws:secretsmanager:eu-north-1:666203386231:secret:uslugar-smtp-config-5xXBg5:SMTP_PORT::"
                },
                {
                    "name": "SMTP_USER",
                    "valueFrom": "arn:aws:secretsmanager:eu-north-1:666203386231:secret:uslugar-smtp-config-5xXBg5:SMTP_USER::"
                },
                {
                    "name": "SMTP_PASS",
                    "valueFrom": "arn:aws:secretsmanager:eu-north-1:666203386231:secret:uslugar-smtp-config-5xXBg5:SMTP_PASS::"
                },
                {
                    "name": "FRONTEND_URL",
                    "valueFrom": "arn:aws:secretsmanager:eu-north-1:666203386231:secret:uslugar-smtp-config-5xXBg5:FRONTEND_URL::"
                },
                {
                    "name": "VAPID_PRIVATE_KEY",
                    "valueFrom": "arn:aws:secretsmanager:eu-north-1:666203386231:secret:uslugar-vapid-keys-kgCgMk:VAPID_PRIVATE_KEY::"
                }
            ],
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-group": "/ecs/uslugar",
                    "awslogs-create-group": "true",
                    "awslogs-region": "eu-north-1",
                    "awslogs-stream-prefix": "ecs"
                }
            },
            "systemControls": []
        },
        {
            "name": "nginx-proxy",
            "image": "666203386231.dkr.ecr.eu-north-1.amazonaws.com/nginx-proxy-uslugar:stable-alpine",
            "cpu": 0,
            "portMappings": [
                {
                    "containerPort": 80,
                    "hostPort": 80,
                    "protocol": "tcp",
                    "name": "nginx-proxy-80-tcp"
                }
            ],
            "essential": true,
            "command": [
                "/bin/sh",
                "-lc",
                "cat >/etc/nginx/conf.d/default.conf <<'CONF'\nserver {\n  listen 80;\n  location / {\n    proxy_pass http://127.0.0.1:8080;\n    proxy_http_version 1.1;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n  }\n  # health za ALB (200 OK,ne dira app)\n  location = /hc { return 200 \"ok\"; add_header Content-Type text/plain; }\n}\nCONF\nexec nginx -g 'daemon off;'"
            ],
            "environment": [],
            "mountPoints": [],
            "volumesFrom": [],
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-group": "/ecs/uslugar",
                    "awslogs-create-group": "true",
                    "awslogs-region": "eu-north-1",
                    "awslogs-stream-prefix": "ecs"
                }
            },
            "healthCheck": {
                "command": [
                    "CMD-SHELL",
                    "wget -q -O- http://127.0.0.1:80/hc >/dev/null || exit 1"
                ],
                "interval": 15,
                "timeout": 5,
                "retries": 2,
                "startPeriod": 10
            },
            "systemControls": []
        }
    ],
    "requiresCompatibilities": [
        "FARGATE"
    ],
    "cpu": "512",
    "memory": "1024"
}
